<!doctype html>
<html lang="nl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Verkoopovereenkomst Generator</title>
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; margin: 24px; }
    h1 { margin-bottom: 8px; }
    .row { display: flex; gap: 16px; flex-wrap: wrap; }
    .col { flex: 1 1 340px; min-width: 320px; }
    label { display: block; font-weight: 600; margin-top: 12px; }
    input, textarea, select, button { width: 100%; padding: 10px; font-size: 14px; }
    textarea { min-height: 190px; font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; }
    .card { border: 1px solid #e6e6e6; border-radius: 12px; padding: 16px; }
    .muted { color: #666; font-size: 14px; }
    .actions { display: flex; gap: 12px; align-items: center; }
    .success { color: #0a7f2e; }
    .error { color: #b00020; white-space: pre-wrap; }
    .small { font-size: 12px; }
    .pill { background: #eef2ff; color: #1e40af; border-radius: 999px; padding: 4px 10px; display: inline-block; }
    .inline { display: inline-flex; align-items: center; gap: 8px; }
    .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 12px; }
    footer { margin-top: 32px; color: #666; font-size: 12px; }
  </style>
</head>
<body>
  <h1>Verkoopovereenkomst Generator</h1>
  <div class="muted">Verbind met je Render API en genereer een DOCX-contract. Geen server nodig voor deze pagina.</div>

  <div class="card" style="margin-top:16px;">
    <div class="inline">
      <span class="pill">Stap 1</span>
      <strong>Vul je API‑basis‑URL in</strong>
    </div>
    <label for="apiBase">API Base URL (Render)</label>
    <input id="apiBase" placeholder="https://jouw-naam.onrender.com" />
    <div class="small muted">Voorbeeld: <code>https://verkoopovereenkomst.onrender.com</code></div>
  </div>

  <div class="row" style="margin-top:16px;">
    <div class="col card">
      <div class="inline"><span class="pill">Stap 2A</span><strong>Snelstart formulier</strong></div>
      <div class="grid">
        <div><label>Makelaar — Naam</label><input id="mak_naam" /></div>
        <div><label>Makelaar — BIV</label><input id="mak_biv" /></div>
        <div><label>Makelaar — Kantoor</label><input id="mak_kantoor" /></div>
        <div><label>Makelaar — Straat</label><input id="mak_straat" /></div>
        <div><label>Makelaar — Nummer</label><input id="mak_nummer" /></div>
        <div><label>Makelaar — Postcode</label><input id="mak_postcode" /></div>
        <div><label>Makelaar — Gemeente</label><input id="mak_gemeente" /></div>
        <div><label>Verkoper — Naam</label><input id="verk_naam" /></div>
        <div><label>Verkoper — Voornaam</label><input id="verk_voornaam" /></div>
        <div><label>Verkoper — E‑mail</label><input id="verk_email" /></div>
        <div><label>Verkoper — Telefoon</label><input id="verk_tel" /></div>
        <div><label>Koper — Naam</label><input id="kop_naam" /></div>
        <div><label>Koper — Voornaam</label><input id="kop_voornaam" /></div>
        <div><label>Koper — E‑mail</label><input id="kop_email" /></div>
        <div><label>Koper — Telefoon</label><input id="kop_tel" /></div>
        <div><label>Goed — Straat</label><input id="straat" /></div>
        <div><label>Goed — Nummer</label><input id="nummer" /></div>
        <div><label>Goed — Postcode</label><input id="postcode" /></div>
        <div><label>Goed — Gemeente</label><input id="gemeente" /></div>
        <div><label>Goed — Aard</label><input id="aard" value="Woning" /></div>
        <div><label>Prijs — Totaal</label><input id="totaal" type="number" value="350000" /></div>
        <div><label>Prijs — Voorschot</label><input id="voorschot" type="number" value="35000" /></div>
        <div><label>Prijs — Saldo</label><input id="saldo" type="number" value="315000" /></div>
      </div>
      <div class="actions" style="margin-top:12px;">
        <button id="genQuick">Genereer DOCX</button>
        <div id="msgQuick" class="muted"></div>
      </div>
    </div>

    <div class="col card">
      <div class="inline"><span class="pill">Stap 2B</span><strong>Geavanceerd (JSON)</strong></div>
      <label>Context (JSON)</label>
      <textarea id="jsonIn" spellcheck="false"></textarea>
      <div class="actions" style="margin-top:12px;">
        <button id="genJson">Genereer DOCX</button>
        <button id="loadSchema" title="Bekijk /schema">Laad Schema</button>
        <div id="msgJson" class="muted"></div>
      </div>
      <pre id="schemaOut" class="small muted" style="margin-top:8px; white-space:pre-wrap;"></pre>
    </div>
  </div>

  <footer>
    <div>Tip: zet CORS aan op je API als je hier CORS‑fouten krijgt (zie README).</div>
  </footer>

  <script>
    function buildQuickContext() {
      return {
        "makelaar": {
          "naam": document.getElementById("mak_naam").value,
          "biv_nummer": document.getElementById("mak_biv").value,
          "kantoor": document.getElementById("mak_kantoor").value,
          "straat": document.getElementById("mak_straat").value,
          "nummer": document.getElementById("mak_nummer").value,
          "postcode": document.getElementById("mak_postcode").value,
          "gemeente": document.getElementById("mak_gemeente").value
        },
        "verkoper": {
          "natuurlijk_persoon": true,
          "naam": document.getElementById("verk_naam").value,
          "voornaam": document.getElementById("verk_voornaam").value,
          "contact": {"email": document.getElementById("verk_email").value, "telefoonnummer": document.getElementById("verk_tel").value}
        },
        "koper": {
          "natuurlijk_persoon": true,
          "naam": document.getElementById("kop_naam").value,
          "voornaam": document.getElementById("kop_voornaam").value,
          "contact": {"email": document.getElementById("kop_email").value, "telefoonnummer": document.getElementById("kop_tel").value}
        },
        "goed": {
          "straat": document.getElementById("straat").value,
          "nummer": document.getElementById("nummer").value,
          "postcode": document.getElementById("postcode").value,
          "gemeente": document.getElementById("gemeente").value,
          "land": "België",
          "aard": document.getElementById("aard").value
        },
        "prijs": {
          "totaal": Number(document.getElementById("totaal").value || 0),
          "voorschot": {"bedrag": Number(document.getElementById("voorschot").value || 0), "overschrijving": true, "als_voorschot": true},
          "saldo_koopsom": Number(document.getElementById("saldo").value || 0)
        },
        "genot": {"niet_verhuurd": true},
        "roerende_goederen": {"geen": true}
      };
    }

    async function postAndDownload(apiBase, path, bodyObj) {
      const res = await fetch(apiBase + path, {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify(bodyObj)
      });
      if (!res.ok) {
        const text = await res.text();
        throw new Error(text);
      }
      const blob = await res.blob();
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "overeenkomst.docx";
      document.body.appendChild(a);
      a.click();
      a.remove();
      URL.revokeObjectURL(url);
    }

    document.getElementById("genQuick").addEventListener("click", async () => {
      const apiBase = document.getElementById("apiBase").value.trim();
      const msg = document.getElementById("msgQuick");
      msg.textContent = "Bezig...";
      try {
        await postAndDownload(apiBase, "/genereer/docx", { context: buildQuickContext() });
        msg.textContent = "Klaar ✓";
        msg.className = "success";
      } catch (e) {
        msg.textContent = "Fout: " + e.message;
        msg.className = "error";
      }
    });

    document.getElementById("genJson").addEventListener("click", async () => {
      const apiBase = document.getElementById("apiBase").value.trim();
      const jsonIn = document.getElementById("jsonIn").value;
      const msg = document.getElementById("msgJson");
      msg.textContent = "Bezig...";
      try {
        const obj = JSON.parse(jsonIn);
        await postAndDownload(apiBase, "/genereer/docx", { context: obj });
        msg.textContent = "Klaar ✓";
        msg.className = "success";
      } catch (e) {
        msg.textContent = "Fout: " + e.message;
        msg.className = "error";
      }
    });

    document.getElementById("loadSchema").addEventListener("click", async () => {
      const apiBase = document.getElementById("apiBase").value.trim();
      const out = document.getElementById("schemaOut");
      out.textContent = "Laden...";
      try {
        const res = await fetch(apiBase + "/schema");
        if (!res.ok) throw new Error(await res.text());
        const data = await res.json();
        out.textContent = JSON.stringify(data, null, 2);
      } catch (e) {
        out.textContent = "Fout: " + e.message;
      }
    });

    document.getElementById("jsonIn").value = JSON.stringify({
      "makelaar": {"naam":"Jan Jansen","biv_nummer":"123456","kantoor":"Immo Jansen","straat":"Stationsstraat","nummer":"12","postcode":"1000","gemeente":"Brussel"},
      "verkoper": {"natuurlijk_persoon": true, "naam":"Piet","voornaam":"Pieter","contact":{"email":"piet@example.com","telefoonnummer":"012345678"}},
      "koper": {"natuurlijk_persoon": true, "naam":"Klara","voornaam":"Klaartje","contact":{"email":"klara@example.com","telefoonnummer":"098765432"}},
      "goed": {"straat":"Dorpsplein","nummer":"1","postcode":"8500","gemeente":"Kortrijk","land":"België","aard":"Woning"},
      "prijs": {"totaal":350000,"voorschot":{"bedrag":35000,"overschrijving":true,"als_voorschot":true},"saldo_koopsom":315000},
      "genot":{"niet_verhuurd": true},
      "roerende_goederen":{"geen": true}
    }, null, 2);
  </script>
</body>
</html>
